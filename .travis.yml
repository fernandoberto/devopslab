language: python
python:
  - 3.7.9
os: linux
dist: xenial
jobs:
  include:
    - stage: Ambiente de Testes
      name: Testes Unitarios
      install:
        - pip install flask flask-wtf coverage
      script:
        - coverage run test.py || travis_terminate 1;
        - coverage report app.py || travis_terminate 1;
        - coverage xml app.py || travis_terminate 1;

    
    - script: 
        - sonar-scanner || travis_terminate 1;
      name: Testes de Qualidade e Seguranca
      addons:
        sonarcloud:
          organization: fernandorberto
          token: '${SONAR_TOKEN}'
    - stage: Deploy ambiente de QA
      name: Deploy ambiene de QA
      script: 'curl -i https://devopslab-fernando-qa.herokuapp.com/'
      deploy:
        provider: heroku
        strategy: api
        api_key: $HEROKU_API_KEY
        edge: true
        app: devops-fernando-qa
        'on':
          branch: main
    - stage: Deploy em Produção
      name: Deploy ambiene de PROD
      script: skip
      deploy:
        provider: heroku
        strategy: api
        api_key: $HEROKU_API_KEY
        edge: true
        app: devops-fernando
        'on':
          branch: main

